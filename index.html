<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyCards.</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    
    <style>
        :root {
            --bg-color: #fcfcfc;
            --text-main: #111111;
            --accent-color: #888;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            text-align: center; 
            background: var(--bg-color); 
            margin: 0; 
            padding: 10px 15px 120px;
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .container { max-width: 450px; margin: 0 auto; }

        h2 {
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: -1px;
            margin: 10px 0 30px;
            display: inline-block;
            width: 100%;
            text-align: center;
        }
        .accent-char {
            color: var(--accent-color);
            transition: color 0.5s ease;
        }

        #cardList { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .list-item { 
            position: relative; height: 85px; border-radius: 20px; 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; cursor: pointer; border: none;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            transition: opacity 0.1s;
        }
        .list-item:active { opacity: 0.6; }
        .list-item-name { color: white; font-weight: bold; font-size: 1.3rem; letter-spacing: 0.5px; }

        .sort-btns { display: flex; flex-direction: column; opacity: 0.4; }
        .sort-btn { background: none; border: none; color: white; font-size: 10px; padding: 4px; cursor: pointer; }

        #detailView { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; flex-direction: column; align-items: center; }
        #detailHeader { width: 100%; height: 25%; display: flex; align-items: center; justify-content: center; color: white; }
        #detailTitle { font-size: 2.2rem; font-weight: bold; }
        
        .barcode-box { 
            background: white; padding: 45px 15px; border-radius: 24px; 
            width: 90%; margin-top: -35px; box-shadow: 0 25px 60px rgba(0,0,0,0.18); 
            display: flex; flex-direction: column; align-items: center;
        }
        svg#barcode { width: 100%; height: auto; max-width: 320px; }

        .back-btn { 
            margin-top: auto; margin-bottom: 70px; padding: 20px 80px; 
            background: #111; color: white; border: none; border-radius: 50px; 
            font-size: 16px; font-weight: bold; letter-spacing: 2px;
        }

        .toggle-link { display: block; padding: 15px; margin-top: 50px; color: #ccc; font-size: 12px; font-weight: bold; cursor: pointer; letter-spacing: 2px; }
        .section-content { display: none; margin-top: 15px; background: #fff; padding: 25px; border-radius: 24px; border: 1px solid #f2f2f2; text-align: left; }
        input, select, textarea { width: 100%; padding: 15px; margin: 10px 0; border-radius: 14px; border: 1px solid #eee; font-size: 16px; box-sizing: border-box; background: #fafafa; outline: none; }
        .add-btn { background: #111; color: white; border: none; padding: 18px; width: 100%; border-radius: 14px; font-weight: bold; margin-top: 15px; font-size: 16px; }
        .delete-btn-mini { background: rgba(255,255,255,0.15); border: none; color: white; padding: 8px 12px; border-radius: 10px; font-size: 10px; margin-right: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h2 id="appTitle">MyC<span class="accent-char">a</span>rds.</h2>
        <div id="cardList"></div>
        <div class="toggle-link" onclick="toggleSection('addArea')">Ôºã ADD NEW CARD</div>
        <div id="addArea" class="section-content">
            <input type="text" id="nameInput" placeholder="„Ç´„Éº„ÉâÂêç">
            <input type="tel" id="cardInput" placeholder="„Éê„Éº„Ç≥„Éº„ÉâÁï™Âè∑">
            <select id="colorInput" onchange="updatePreviewColor(this.value)">
                <option value="#1a1a1a">‚ö´ Black</option>
                <option value="#E53935">üî¥ Red</option>
                <option value="#1E88E5">üîµ Blue</option>
                <option value="#FB8C00">üü† Orange</option>
                <option value="#43A047">üü¢ Green</option>
                <option value="#FDD835">üü° Yellow</option>
                <option value="#8E24AA">üü£ Purple</option>
            </select>
            <button class="add-btn" id="saveBtn" onclick="addCard()">„É™„Çπ„Éà„Å´ËøΩÂä†</button>
        </div>
        <div class="toggle-link" onclick="toggleSection('backupArea')">‚öô SETTINGS</div>
        <div id="backupArea" class="section-content">
            <button onclick="exportData()" style="width:100%; padding:12px; background:#f5f5f5; border:none; border-radius:12px; font-weight:bold; color:#666;">„Éá„Éº„Çø„ÇíÊõ∏„ÅçÂá∫„Åô</button>
            <textarea id="backupText" rows="2" style="margin-top:10px; font-size:10px; color:#999;" readonly></textarea>
            <input type="text" id="importInput" placeholder="Âæ©ÂÖÉ„Ç≥„Éº„Éâ„ÇíË≤º‰ªò" style="margin-top:20px;">
            <button onclick="importData()" style="width:100%; padding:12px; background:#111; color:white; border:none; border-radius:12px; font-weight:bold;">„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ</button>
        </div>
    </div>

    <div id="detailView">
        <div id="detailHeader">
            <div id="detailTitle"></div>
        </div>
        <div class="barcode-box">
            <svg id="barcode"></svg>
        </div>
        <button class="back-btn" onclick="closeDetail()">DONE</button>
    </div>

    <script>
        window.onload = displayList;

        function updatePreviewColor(color) {
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.style.backgroundColor = color;
            document.documentElement.style.setProperty('--accent-color', color);
        }

        function displayList() {
            const list = getList();
            const container = document.getElementById('cardList');
            container.innerHTML = (list.length === 0) ? "<p style='color:#ccc; padding:60px;'>„Ç´„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>" : "";
            if (list.length > 0) {
                const lastColor = list[list.length - 1].color;
                document.documentElement.style.setProperty('--accent-color', lastColor);
            }
            list.forEach((card, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.style.backgroundColor = card.color;
                div.innerHTML = `
                    <div class="list-item-name" style="flex-grow:1; text-align:left;" onclick="openDetail(${index})">${card.name}</div>
                    <button class="delete-btn-mini" onclick="deleteCard(${index})">ÂâäÈô§</button>
                    <div class="sort-btns">
                        <button class="sort-btn" onclick="moveCard(${index}, -1)">‚ñ≤</button>
                        <button class="sort-btn" onclick="moveCard(${index}, 1)">‚ñº</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function moveCard(index, direction) {
            const list = getList();
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < list.length) {
                const temp = list[index]; list[index] = list[newIndex]; list[newIndex] = temp;
                saveList(list); displayList();
            }
        }

        function openDetail(index) {
            const list = getList();
            const card = list[index];
            document.getElementById('detailHeader').style.backgroundColor = card.color;
            document.getElementById('detailTitle').innerText = card.name;
            document.getElementById('detailView').style.display = 'flex';

            // „ÅÇ„Åà„Å¶CODE128„Å´Âõ∫ÂÆö„Åó„Å¶„ÄÅ„Åô„Åπ„Å¶„ÅÆÁ∑ö„ÅÆÈ´ò„Åï„ÇíÊèÉ„Åà„Çã
            JsBarcode("#barcode", card.num, {
                format: "CODE128",
                displayValue: true,
                width: 2.1,   // Á∑ö„ÅÆÂØÜÂ∫¶„Çí‰∏ä„Åí„Å¶Áæé„Åó„Åè
                height: 90,   // È´ò„Åï„ÇíÊäë„Åà„Å¶„Çπ„Çø„Ç§„É™„ÉÉ„Ç∑„É•„Å´
                fontSize: 22, // Êï∞Â≠ó„ÇíÂ∞ë„ÅóÊéß„Åà„ÇÅ„Å´„Åó„Å¶„Éê„Éº„Çí‰∏ªÂΩπ„Å´
                textMargin: 15, // ‰ΩôÁôΩ„Çí„Åü„Å£„Å∑„ÇäÂèñ„Å£„Å¶„É¢„ÉÄ„É≥„Å™Âç∞Ë±°„Å´
                margin: 20,
                background: "#ffffff"
            });
        }

        function closeDetail() { document.getElementById('detailView').style.display = 'none'; }
        function toggleSection(id) {
            const el = document.getElementById(id);
            const isVisible = el.style.display === 'block';
            document.getElementById('addArea').style.display = 'none';
            document.getElementById('backupArea').style.display = 'none';
            if (!isVisible) el.style.display = 'block';
        }
        function addCard() {
            const name = document.getElementById('nameInput').value;
            const num = document.getElementById('cardInput').value.replace(/\s+/g, '');
            const color = document.getElementById('colorInput').value;
            if (name && num) {
                const list = getList();
                list.push({ name, num, color });
                saveList(list);
                location.reload();
            }
        }
        function deleteCard(index) {
            if(confirm("ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) {
                const list = getList();
                list.splice(index, 1);
                saveList(list);
                displayList();
            }
        }
        function getList() { return JSON.parse(localStorage.getItem('cardList') || '[]'); }
        function saveList(list) { localStorage.setItem('cardList', JSON.stringify(list)); }
        function exportData() { document.getElementById('backupText').value = localStorage.getItem('cardList'); }
        function importData() {
            try {
                const code = document.getElementById('importInput').value;
                if(!code) return;
                JSON.parse(code);
                localStorage.setItem('cardList', code);
                location.reload();
            } catch(e) { alert("ÁÑ°Âäπ„Å™„Ç≥„Éº„Éâ„Åß„Åô"); }
        }
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW error', err));
            });
        }
    </script>
</body>
</html>
