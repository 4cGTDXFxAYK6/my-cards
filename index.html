<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyCards.</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-512.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

    <style>
        :root {
            --bg-color: #f1f3f5;
            --card-bg: #ffffff;
            --text-main: #111111;
            --text-sub: #888888;
            --accent-color: #888;
            --btn-blue: #0077c2;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            margin: 0;
            padding: 20px 15px 120px;
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        .container { max-width: 450px; margin: 0 auto; text-align: left; }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        h2 { font-size: 2.8rem; font-weight: 900; letter-spacing: -1.5px; margin: 10px 0 0; }
        .accent-char { color: var(--accent-color); transition: color .5s ease; }
        .sub-label { font-size: 0.8rem; color: var(--text-sub); font-weight: bold; margin-bottom: 30px; display: block; }

        /* ID„É©„Éô„É´ */
        .section-label {
            font-size: 0.75rem;
            font-weight: 800;
            color: #444;
            margin: 25px 0 10px 5px;
            text-transform: uppercase;
        }

        /* „Ç´„Éº„Éâ„É™„Çπ„Éà */
        #cardList { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .list-item {
            background: var(--card-bg);
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: transform 0.1s;
        }
        .color-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .list-item-name { font-weight: 600; font-size: 1rem; flex-grow: 1; text-align: left; }
        
        .delete-btn-mini {
            background: #f8f9fa; border: none; color: #cc0000;
            padding: 5px 8px; border-radius: 6px; font-size: 0.65rem;
            margin-right: 8px; font-weight: bold; cursor: pointer;
        }

        .sort-btns { display: flex; flex-direction: column; gap: 2px; }
        .sort-btn { background: none; border: none; color: #ccc; font-size: 8px; padding: 2px; cursor: pointer; }

        /* ÂÖ•Âäõ„Ç®„É™„Ç¢ */
        .section-content { display: none; background: #e9ecef; padding: 20px; border-radius: 16px; margin-top: 10px; }
        input, select, textarea {
            width: 100%; padding: 14px; margin: 8px 0; border-radius: 10px;
            border: none; font-size: 0.95rem; box-sizing: border-box;
            background: #ffffff; outline: none;
        }

        /* Âàá„ÇäÊõø„Åà„É™„É≥„ÇØ */
        .toggle-link {
            display: block; padding: 15px; margin-top: 20px;
            background: #ffffff; border-radius: 10px;
            color: #333; font-size: 0.8rem; font-weight: 800;
            cursor: pointer; text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* „Éú„Çø„É≥ */
        .main-btn {
            background: #111; color: white; border: none;
            width: 100%; border-radius: 30px; font-weight: bold;
            font-size: 0.9rem; display: flex;
            justify-content: space-between; align-items: center;
            padding: 14px 25px; cursor: pointer; margin-top: 10px;
        }
        .main-btn::after { content: '„Äâ'; font-size: 0.8rem; opacity: 0.5; }

        .blue-btn { background: var(--btn-blue); margin-top: auto; margin-bottom: 50px; width: 85%; }

        /* Ë©≥Á¥∞ÁîªÈù¢ */
        #detailView {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: var(--bg-color);
            z-index: 100; flex-direction: column; align-items: center;
        }
        #detailHeader {
            width: 100%; height: 35%; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
            padding-bottom: 40px; box-sizing: border-box;
        }
        #detailTitle { font-size: 2.2rem; font-weight: 800; margin-top: 20px; }
        
        .barcode-box {
            background: white; padding: 40px 20px; border-radius: 20px;
            width: 85%; margin-top: -60px; box-shadow: 0 15px 40px rgba(0,0,0,0.12);
            display: flex; flex-direction: column; align-items: center;
        }
        svg#barcode { width: 100%; height: auto; max-width: 320px; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="appTitle">MyC<span class="accent-char">a</span>rds.</h2>
    <span class="sub-label">accent-char #888</span>

    <div class="section-label">ID cardList</div>
    <div id="cardList"></div>

    <div class="section-label">ID ADD NEW CARD</div>
    <div class="toggle-link" id="addToggle">Ôºã ADD NEW CARD</div>
    <div id="addArea" class="section-content">
        <input type="text" id="nameInput" placeholder="„Ç´„Éº„ÉâÂêç">
        <input type="tel" id="cardInput" placeholder="„Éê„Éº„Ç≥„Éº„ÉâÁï™Âè∑ (13Ê°Å)">
        <select id="colorInput">
            <option value="#1a1a1a">‚ö´ Black</option>
            <option value="#E53935">üî¥ Red</option>
            <option value="#1E88E5">üîµ Blue</option>
            <option value="#FB8C00">üü† Orange</option>
            <option value="#43A047">üü¢ Green</option>
            <option value="#FDD835">üü° Yellow</option>
            <option value="#8E24AA">üü£ Purple</option>
        </select>
        <button class="main-btn" id="saveBtn">Add-btn</button>
    </div>

    <div class="section-label">ID SETTINGS</div>
    <div class="toggle-link" id="settingsToggle">‚öô SETTINGS</div>
    <div id="backupArea" class="section-content">
        <button id="exportBtn" style="width:100%; padding:12px; background:#fff; border:none; border-radius:10px; font-weight:bold; color:#666;">„Éá„Éº„Çø„ÇíÊõ∏„ÅçÂá∫„Åô</button>
        <textarea id="backupText" rows="2" style="margin-top:10px; font-size:10px; color:#999;" readonly></textarea>
        <input type="text" id="importInput" placeholder="Âæ©ÂÖÉ„Ç≥„Éº„Éâ„ÇíË≤º‰ªò" style="margin-top:20px;">
        <button id="importBtn" style="width:100%; padding:12px; background:#111; color:white; border:none; border-radius:10px; font-weight:bold;">„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ</button>
    </div>
</div>

<div id="detailView">
    <div id="detailHeader">
        <div class="section-label" style="color:rgba(255,255,255,0.7); margin:0;">ID detail view</div>
        <div id="detailTitle"></div>
    </div>
    <div class="barcode-box">
        <div class="section-label" style="margin:0 0 20px 0; align-self: flex-start;">detail Title</div>
        <svg id="barcode"></svg>
    </div>
    <button class="main-btn blue-btn" id="backBtn">Back-btn</button>
</div>

<script>
/** * Êèê‰æõ„Åï„Çå„ÅüJavaScript„É≠„Ç∏„ÉÉ„ÇØÔºà„Åù„ÅÆ„Åæ„ÅæÁ∂≠ÊåÅÔºâ
 */
document.addEventListener("DOMContentLoaded", () => {
    displayList();
    document.getElementById("addToggle").addEventListener("click", () => toggleSection("addArea"));
    document.getElementById("settingsToggle").addEventListener("click", () => toggleSection("backupArea"));
    document.getElementById("saveBtn").addEventListener("click", addCard);
    document.getElementById("exportBtn").addEventListener("click", exportData);
    document.getElementById("importBtn").addEventListener("click", importData);
    document.getElementById("backBtn").addEventListener("click", closeDetail);
    document.getElementById("colorInput").addEventListener("change", (e)=>updatePreviewColor(e.target.value));
});

function updatePreviewColor(color){
    document.getElementById("saveBtn").style.backgroundColor=color;
    document.documentElement.style.setProperty("--accent-color",color);
}

function displayList(){
    const list=getList();
    const container=document.getElementById("cardList");
    container.innerHTML="";
    if(list.length===0){
        const p=document.createElement("p");
        p.style.color="#999";
        p.style.padding="40px";
        p.style.textAlign="center";
        p.style.fontSize="0.8rem";
        p.textContent="„Ç´„Éº„Éâ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";
        container.appendChild(p);
        return;
    }
    document.documentElement.style.setProperty("--accent-color",list[list.length-1].color);

    list.forEach((card,index)=>{
        const div=document.createElement("div");
        div.className="list-item";
        
        // ÁîªÂÉèUI„Å´Âêà„Çè„Åõ„Åü„Éâ„ÉÉ„Éà„ÅÆËøΩÂä†
        const dot = document.createElement("div");
        dot.className = "color-dot";
        dot.style.backgroundColor = card.color;

        const nameDiv=document.createElement("div");
        nameDiv.className="list-item-name";
        nameDiv.style.flexGrow="1";
        nameDiv.style.textAlign="left";
        nameDiv.textContent=card.name;
        nameDiv.addEventListener("click",()=>openDetail(index));

        const del=document.createElement("button");
        del.className="delete-btn-mini";
        del.textContent="ÂâäÈô§";
        del.addEventListener("click",(e)=>{ e.stopPropagation(); deleteCard(index); });

        const sortBox=document.createElement("div");
        sortBox.className="sort-btns";
        const up=document.createElement("button");
        up.className="sort-btn";
        up.textContent="‚ñ≤";
        up.addEventListener("click",(e)=>{ e.stopPropagation(); moveCard(index,-1); });
        const down=document.createElement("button");
        down.className="sort-btn";
        down.textContent="‚ñº";
        down.addEventListener("click",(e)=>{ e.stopPropagation(); moveCard(index,1); });

        sortBox.append(up,down);
        div.append(dot,nameDiv,del,sortBox); // dot„ÇíËøΩÂä†
        container.appendChild(div);
    });
}

function addCard(){
    const name=document.getElementById("nameInput").value;
    const num=document.getElementById("cardInput").value.replace(/\s+/g,"");
    const color=document.getElementById("colorInput").value;
    if(name&&num){
        const list=getList();
        list.push({name,num,color});
        saveList(list);
        displayList();
        toggleSection();
        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢ËøΩÂä†ÔºàÂà©‰æøÊÄß„ÅÆ„Åü„ÇÅÔºâ
        document.getElementById("nameInput").value = "";
        document.getElementById("cardInput").value = "";
    }
}

function moveCard(index,d){
    const list=getList();
    const n=index+d;
    if(n>=0&&n<list.length){
        [list[index],list[n]]=[list[n],list[index]];
        saveList(list);
        displayList();
    }
}

function openDetail(index){
    const card=getList()[index];
    document.getElementById("detailHeader").style.backgroundColor=card.color;
    document.getElementById("detailTitle").innerText=card.name;
    document.getElementById("detailView").style.display="flex";
    const format=(card.num.length===13&&/^\d+$/.test(card.num))?"EAN13":"CODE128";
    JsBarcode("#barcode",card.num,{format,displayValue:true,width:2.2,height:100,fontSize:26,textMargin:12,margin:25,background:"#ffffff"});
}

function closeDetail(){
    document.getElementById("detailView").style.display="none";
}

function toggleSection(id){
    document.getElementById("addArea").style.display="none";
    document.getElementById("backupArea").style.display="none";
    if(id)document.getElementById(id).style.display="block";
}

function deleteCard(index){
    if(confirm("ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")){
        const list=getList();
        list.splice(index,1);
        saveList(list);
        displayList();
    }
}

function getList(){return JSON.parse(localStorage.getItem("cardList")||"[]");}
function saveList(list){localStorage.setItem("cardList",JSON.stringify(list));}
function exportData(){document.getElementById("backupText").value=localStorage.getItem("cardList");}

function importData(){
    try{
        const code=document.getElementById("importInput").value;
        if(!code)return;
        const parsed=JSON.parse(code);
        if(!Array.isArray(parsed))throw new Error();
        saveList(parsed);
        displayList();
    }catch{alert("ÁÑ°Âäπ„Å™„Ç≥„Éº„Éâ„Åß„Åô");}
}
</script>
</body>
</html>
